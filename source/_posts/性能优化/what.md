---
title: 以用户为中心的性能优化指标有哪些？
category: 性能优化
top: 93
---

您可能已无数次听人提及性能的重要性，以及网页应用的运行速度十分关键。因为：

1. 性能关乎用户的去留
2. 性能关乎转化率的提升
3. 性能关乎用户体验
4. 性能关乎用户：性能低的网站和应用还会导致用户产生实际成本

但是，当您尝试回答“我的应用有多快？”这个问题时，您就会意识到，“快”是一个很模糊的概念。 我们所谓的“快”究竟是指什么？其情境为何？ 为谁提供高速度？提高到什么程度？

## 1. 两个谬见

首先我们看一下两个常见的性能谬见：

> 我已经测试我的应用，加载时间为 X.XX 秒。  
> 性能只是加载时间的问题

这两个观点都非常片面，

对于**第一个观点**，因为加载时间会因为用户不同而有很大的变化，具体取决于用户的设备功能以及网络状况。 以单个数字的形式呈现加载时间忽略了遭遇过长加载时间的用户。

实际上，应用的加载时间是每个用户所有加载时间的汇总，而全面表示加载时间的唯一方法是使用以下直方图所示的分布方法：

![](.gitbook/assets/55059453-fa448380-50a9-11e9-8bd3-ce4114082a02.png)

X 轴上的数字显示加载时间，而 Y 轴上条的高度显示体验到特定时间段中加载时间的用户相对数量。 正如此图表所示，虽然最大的用户群体验到的加载时间不到 1 或 2 秒，但仍有很多用户体验到相当长的加载时间。

此外，加载并非单一的时刻，在加载过程中，有多个时刻都会影响到用户对速度的感知，如果只关注其中某个时刻，就可能会遗漏其余时间内用户感受到的不良体验。

例如，假定某应用针对快速初始渲染进行优化，以便立刻将内容传递给用户。 然后，如果该应用加载一个需要花费数秒来解析和执行的大型 JavaScript 软件包，那么只有在 JavaScript 运行之后，页面上的内容才可供交互。

如果用户可以看到页面上的链接但无法点击，或者可以看到文本框但无法在其中输入内容，他们可能就不会关心页面渲染的速度有多快。

因此，我们不应该只使用一个指标来衡量加载，而应该衡量整个体验过程中可能影响用户对加载的感知的每个时刻。

对于**第二个观点**，事实是，随时都有可能发生性能不佳的情况，不只限于加载期间。 应用无法迅速响应点按或点击操作，以及无法平滑滚动或产生动画效果的问题与加载缓慢一样，都会导致糟糕的用户体验。 用户关心的是总体体验，我们开发者也应如此。

要想提升性能，首先得衡量性能，但是我们应该衡量什么呢？因此我们必须弄清楚下面的问题：

1. 哪些指标能够最准确地衡量人所感受到的性能？
2. 如何针对实际用户来衡量这些指标？
3. 如何解读衡量结果以确定应用是否“速度快”？
4. 了解应用的实际用户性能之后，如何避免性能下降并在未来提高性能？

## 2. 性能指标

当用户导航到网页时，通常会寻找视觉反馈，以确信一切符合预期

![](.gitbook/assets/55059504-10524400-50aa-11e9-9029-f2a9e179c005.png)

为了解页面何时为用户提供这样的反馈，我们定义了多个新指标：

> FP \(First Paint\)：首次绘制  
> FCP \(First Contentful Paint\)：首次内容绘制  
> FMP \(First Meaningful Paint\)：首次有效绘制  
> TTI \(Time To Interaction\)：可交互时

### 2.1 首次绘制与首次内容绘制 - FP/FCP

FP和FCP回答了“ 是否发生？”这一问题，  
FP 标记浏览器渲染任何在视觉上不同于导航前屏幕内容之内容的时间点  
FCP 标记的是浏览器渲染来自 DOM 第一位内容的时间点

### 2.2 首次有效绘制和主角元素计时 - FMP

FMP 指标能够回答“是否有用？”这一问题。 虽然“有用”这一概念很难以通用于所有网页的方式规范化（因此尚不存在任何规范），但是网页开发者自己很清楚其页面的哪些部分对用户最为有用。

![](.gitbook/assets/55059515-1b0cd900-50aa-11e9-9de6-33f4588e79c6.png)

网页的这些“最重要部分”通常称为主角元素。 例如，在 YouTube 观看页面上，主视频就是主角元素。 在 Twitter 上，主角元素可能是通知标志和第一篇推文。 在天气应用上，主角元素是指定地点的天气预测。 在新闻网站上，主角元素可能是重大新闻和置顶大图。

### 2.3 耗时较长的任务

浏览器通过将任务添加到主线程上的队列等待逐个执行来响应用户输入。 浏览器执行应用的 JavaScript 时也会这样做，因此从这个角度看，浏览器为单线程。

在某些情况下，运行这些任务可能要花费较长时间，如果确实如此，主线程就会遭到阻止，而队列中的所有其他任务都必须等待。

对于用户而言，任务耗时较长表现为滞后或卡顿，而这也是目前网页不良体验的主要根源

### 2.4 可交互时间 - TTI

TTI 指标用于标记应用已进行视觉渲染并能可靠响应用户输入的时间点。 应用可能会因为多种原因而无法响应用户输入：

* 页面组件运行所需的 JavaScript 尚未加载。
* 耗时较长的任务阻塞主线程

TTI 指标可识别页面初始 JavaScript 已加载且主线程处于空闲状态（没有耗时较长的任务）的时间点。

### 2.5 将指标对应到用户体验

![](.gitbook/assets/55059545-28c25e80-50aa-11e9-82e9-e9b1a740923b%20%281%29.png)

下列加载时间线屏幕截图有助于您更直观地了解加载指标对应的加载体验：

![](.gitbook/assets/55059552-2e1fa900-50aa-11e9-8fbd-b425554d772f.png)

## 3. RAIL 指导原则

RAIL 是一种以用户为中心的性能模型。每个网络应用均具有与其生命周期有关的四个不同方面，且这些方面以不同的方式影响着性能：

![](.gitbook/assets/55059657-78088f00-50aa-11e9-95a0-7d07f5978bae.png)

* 以用户为中心；最终目标不是让您的网站在任何特定设备上都能运行很快，而是使用户满意。
* 立即响应用户；在 100 毫秒以内确认用户输入。对于需要超过 500 毫秒才能完成的操作，请始终提供反馈。
* 设置动画或滚动时，在 10 毫秒以内生成帧。从纯粹的数学角度而言，每帧的预算约为 16 毫秒（1000 毫秒 / 60 帧 = 16.66 毫秒/帧）。 但因为浏览器需要花费时间将新帧绘制到屏幕上，只有 10 毫秒来执行代码。
* 最大程度增加主线程的空闲时间。例如，尽可能减少预加载数据，以便您的应用快速加载，并利用空闲时间加载剩余数据。推迟的工作应分成每个耗时约 50 毫秒的多个块。如果用户开始交互，优先级最高的事项是响应用户。要实现小于 100 毫秒的响应，应用必须在每 50 毫秒内将控制返回给主线程，这样应用就可以执行其像素管道、对用户输入作出反应，等等。以 50 毫秒块工作既可以完成任务，又能确保即时的响应。
* 持续吸引用户；在 1000 毫秒以内呈现交互内容。在 1 秒钟内加载您的网站。否则，用户的注意力会分散，他们处理任务的感觉会中断。

![](.gitbook/assets/55059667-7e970680-50aa-11e9-8e10-632da04577b6.png)

关键 RAIL 指标汇总

![](.gitbook/assets/55059677-848ce780-50aa-11e9-9bbc-5291cc5516a8.png)


---
title: 什么是纯函数？
category: 函数式编程
date: 2020-11-04
top: 98
---

纯函数的概念：

> 纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。


他的**重点在于“相同的输入，永远会得到相同的输出”**，后面所说的副作用其实也是为了满足这一点。

在详细说明纯函数之前，先讲两个其他的概念：**可变数据类型和不可变数据类型**

我们知道，在Javascript中，基本数据类型都是不可变的，他们只能被替换，不能被修改。例如：当我们在对字符串进行操作的时候，我们并不能改变这个字符串本身，我们能做的只有把返回的新字符串重新赋值给变量。

```js
var str = 'I am hero';
console.log(str.toUpperCase());	// "I AM HERO"
console.log(str);	//"I am hero"
str = str.toUpperCase()
```

而引用数据类型都是可变的，存在变量中的仅仅就是一个地址

我们不妨把纯函数换一种方式理解，不把它当作一个只有“完全满足要求”和“不满足要求”的标准，而把它想象成一个范围，在这里有高低不同程度的纯函数

## 如何理解“相同的输入，永远会得到相同的输出”

### 避免共享状态
共享状态是指存在于共享作用域中的任何变量、对象或内存空间，或者是作用域之间对象属性的传递。共享作用域可以包括全局作用域或闭包作用域。

共享状态的问题在于，为了理解函数的效果，

### 避免可改变数据


### 副作用




## 一些例子

```js
var a = 5;
function A(b) {
  return a + b;
}
A(5);
```
A函数是一个纯函数吗？显然非常不纯，在程序执行的过程中，变量a很容易被修改，这就会导致每次调用A(5)的返回值改变。

对例一稍作修改:
```js
const a = 5;
function A(b) {
  return a + b;
}
A(5);
```
这是纯函数，确定的输入，确定的输出。

把例二数字常量换成对象
```js
const obj = {id: 5};
function A(_obj) {
  return _obj.id;
}
A(obj);
```
函数A基本上是纯函数，为什么说是“基本上”？因为有极端情况如下
```js
var obj = {
  get id() {
    return Math.random();
  }
}
```
注意，obj在传进函数A之前是确定的，getter是在取值的时候才会执行，但是返回的结果是不确定的，所以这个时候函数A就不是纯函数了。随机数和Date都会造成函数不纯，使用的时候要注意。

除此之外，由于对象是可变数据类型，我们在每次输入变量obj到函数A中时，并不具有绝对的自信会返回确定的值。可对于函数A来说，它只关心传进来的数据是什么，而对于那个数据来说，只要不是上面的极端情况，返回的是确定的值。

稍作修改:
```js
const obj = Object.freeze({id: 5});
function A(b) {
  return obj.id + b;
}
A(5);
```

这样就纯多了，可是需要注意的是，Object.freeze()这个方法无法冻结嵌套的对象，例如
```js
const obj = Object.freeze({a: {a: 5}});
obj.a.a = 10;
function A(b) {
  return obj.a.a + b;
}
console.log(A(5));	// 15，不纯
```



